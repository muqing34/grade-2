<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心理科普 - 心理文字游戏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

<!-- 导航栏 -->
<nav class="bg-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex">
                <div class="flex-shrink-0 flex items-center text-xl font-bold text-blue-600">
                    心理冒险
                </div>
                <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                    <a href="game.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                        游戏
                    </a>
                    <a href="knowledge.html" class="border-blue-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                        心理科普
                    </a>
                    <a href="profile.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                        个人资料
                    </a>
                </div>
            </div>
            <div class="flex items-center">
                <!-- 根据是否登录决定显示 登出 或 登录 -->
                <button id="auth-button" class="bg-blue-600 text-white px-3 py-1.5 rounded-md text-sm font-medium hover:bg-blue-700 transition">
                    <!-- JS会填充内容 -->
                </button>
            </div>
        </div>
    </div>
</nav>

<!-- 内容区 -->
<div class="py-10">
    <header class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-3xl font-bold leading-tight text-gray-900">心理知识库</h1>
        <p class="mt-2 text-gray-600">了解更多关于心理健康的知识（模拟API数据）。</p>
    </header>
    <main>
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 mt-6">
            <div id="articles-list" class="space-y-6">
                <!-- 文章列表将动态加载于此 -->
                <p class="text-gray-500">正在加载文章...</p>
            </div>
        </div>
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        setupAuthButton();
        loadArticles();
    });

    // 设置右上角按钮（登录/登出）
    function setupAuthButton() {
        const token = localStorage.getItem('jwtToken');
        const authButton = document.getElementById('auth-button');
        if (token) {
            authButton.textContent = '登出';
            authButton.className = 'bg-red-600 text-white px-3 py-1.5 rounded-md text-sm font-medium hover:bg-red-700 transition';
            authButton.onclick = () => {
                localStorage.removeItem('jwtToken');
                window.location.href = 'index.html';
            };
        } else {
            authButton.textContent = '登录';
            authButton.className = 'bg-blue-600 text-white px-3 py-1.5 rounded-md text-sm font-medium hover:bg-blue-700 transition';
            authButton.onclick = () => {
                window.location.href = 'index.html';
            };
        }
    }

    // 加载文章
    async function loadArticles() {
        const articlesList = document.getElementById('articles-list');
        try {
            // 此API是公开的，不需要JWT
            const response = await fetch('/api/knowledge/articles');

            if (!response.ok) {
                throw new Error('无法加载文章');
            }

            const articles = await response.json();
            renderArticles(articles);

        } catch (error) {
            console.error('加载文章失败:', error);
            articlesList.innerHTML = `<p class="text-red-500">加载文章失败：${error.message}</p>`;
        }
    }

    function renderArticles(articles) {
        const articlesList = document.getElementById('articles-list');
        articlesList.innerHTML = ''; // 清空加载提示

        if (!articles || articles.length === 0) {
            articlesList.innerHTML = '<p class="text-gray-500">暂无文章。</p>';
            return;
        }

        articles.forEach(article => {
            const articleEl = document.createElement('div');
            articleEl.className = 'bg-white shadow-lg rounded-lg p-6 hover:shadow-xl transition-shadow duration-300';
            articleEl.innerHTML = `
                <h3 class="text-xl font-semibold mb-2 text-blue-700">${article.title}</h3>
                <p class="text-gray-600">${article.summary}</p>
                <a href="#" class="inline-block mt-4 text-sm font-medium text-blue-600 hover:text-blue-800">阅读更多 &rarr;</a>
            `;
            articlesList.appendChild(articleEl);
        });
    }
</script>
</body>
</html>
